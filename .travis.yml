language: python
cache:
  directories:
  - "$HOME/.cache/pip"
  - "$HOME/.cache/pre-commit"
python:
- '3.6'
addons:
  postgresql: '9.6'
  apt:
    packages:
    - expect-dev
stages:
- linting
- install
- test
jobs:
  include:
  - stage: linting
    name: pre-commit
    python: '3.6'
    install: pip install pre-commit
    script: pre-commit run --all --show-diff-on-failure --verbose --color always
    after_success: 
    before_install: 
    - echo -e "machine github.com\n  login $CI_USER_TOKEN" > ~/.netrc
  - stage: test
    env:
    - TESTS="1" ODOO_REPO="odoo/odoo" MAKEPOT="1"
  - stage: test
    env:
    - TESTS="1" ODOO_REPO="OCA/OCB"
  - stage: install
    env:
    - TESTS="1" ODOO_REPO="odoo/odoo" MAKEPOT="1" TEST_ENABLE="0" EXCLUDE=""
  - stage: install
    env:
    - TESTS="1" ODOO_REPO="OCA/OCB" TEST_ENABLE="0" EXCLUDE=""
env:
  global:
  - VERSION="12.0" TESTS="0" LINT_CHECK="0" MAKEPOT="0"
  - PHANTOMJS_VERSION="latest"
  - WEBSITE_REPO="1"
  - EXCLUDE="partner_category_hierarchy,website_forum_visibility"
install:
- git clone --depth=1 https://github.com/OCA/maintainer-quality-tools.git ${HOME}/maintainer-quality-tools
- export PATH=${HOME}/maintainer-quality-tools/travis:${PATH}
- travis_install_nightly
script:
- travis_run_tests
after_success:
- travis_after_tests_success
CI_USER_TOKEN:
  secure: Qk0llBslFh2ubclYMzbodxvRFDql5EYf2u43J6gtK0W1/PuJrXkRUqJ+6ULvrWSj+GLxIp8yR6EBu2ysEAYDbhooWi5xr+MriaFcFVxXsQ3n4ayNIe/bbaCaIWqz6H0R54fyRMiFanq9QAaYaF4d9iiepW/d6knMECpXGCCgWiP0SVxYkj8BVPcRzrvctoWAM5uiCBTFszmI9dvZOzTQZ9gmCjDOmg0NZcoKbRSnd/mYyHib87GK79owtkbYLMfInv2txy1S/XxOAUhuL1h7ShbEpvvbZe8KAZgq8wGhMNNyT7oFoypEovm6KZP7a+QMp/Q0DLyrK2+V88XvKDFz4Z6Wu1P63Z4D/HGXZAYUBSmiNKSJLSqnQAuDnhtZ0fssxbLRdSUgEvgaSZQu03URdSGRRQu+yiyu5uxt4dtyxYBDcPZFx9xStLwBdF4rOiq8E3v+YBrQqMJrXkvdoZhuJPGjXJHa9ONP4EbTfKf42MQOPsodNQIxP04wiyGW3zRkLSvJi8hApXSgxBBiFHBelBVibdkfD57zCCAW4JGxSgFSNvTAfm+UgYVGQh7nfFiVuK+7zs4Hk3h2o8tmeXNRwgp3sbgRt8UU9Y7CrVwcHA4jW9hdaF4hWWIfdn6qUO0EWKqjjwpMsKZC4DJ1XOxIL3qudRyaCZT5HdRIS1lL3EQ=
